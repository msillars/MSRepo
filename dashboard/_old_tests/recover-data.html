<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Recovery Tool</title>
    <style>
        body {
            font-family: 'Futura', 'Century Gothic', sans-serif;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { margin-bottom: 20px; }
        .section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #000;
        }
        button {
            padding: 12px 24px;
            background: #000;
            color: white;
            border: none;
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #333;
        }
        textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 12px;
            padding: 10px;
            margin-top: 10px;
        }
        .status {
            padding: 10px;
            margin-top: 10px;
            background: #fff;
            border: 1px solid #ccc;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <h1>üîß Data Recovery Tool</h1>
    
    <div class="section">
        <h2>Step 1: Check Old Data</h2>
        <p>Click to see if your old data exists in browser storage:</p>
        <button onclick="checkOldData()">Check Old Storage Key</button>
        <button onclick="checkNewData()">Check New Storage Key</button>
        <div id="check-status" class="status"></div>
        <textarea id="old-data-display" placeholder="Old data will appear here..."></textarea>
    </div>
    
    <div class="section">
        <h2>Step 2: Migrate Data</h2>
        <p>If old data exists, click to migrate it to the new system:</p>
        <button onclick="migrateData()">Migrate Old Data to New System</button>
        <div id="migrate-status" class="status"></div>
    </div>
    
    <div class="section">
        <h2>Step 3: Manual Recovery</h2>
        <p>If you have a backup, paste it here and click restore:</p>
        <textarea id="manual-data" placeholder="Paste backup data here..."></textarea>
        <button onclick="manualRestore()">Restore Data</button>
        <div id="restore-status" class="status"></div>
    </div>
    
    <div class="section">
        <h2>Export Current Data (Backup)</h2>
        <button onclick="exportNewData()">Export Current Data</button>
        <textarea id="export-display" placeholder="Current data will appear here..."></textarea>
    </div>

    <script>
        const OLD_KEY = 'management-system-ideas';
        const NEW_KEY = 'management_system_ideas';
        const NEW_PROJECTS_KEY = 'management_system_projects';
        
        function checkOldData() {
            const oldData = localStorage.getItem(OLD_KEY);
            const display = document.getElementById('old-data-display');
            const status = document.getElementById('check-status');
            
            if (oldData) {
                display.value = oldData;
                const ideas = JSON.parse(oldData);
                status.className = 'status success';
                status.textContent = `‚úÖ Found ${ideas.length} ideas in old storage!`;
            } else {
                status.className = 'status error';
                status.textContent = '‚ùå No data found in old storage key';
                display.value = 'No old data found';
            }
        }
        
        function checkNewData() {
            const newData = localStorage.getItem(NEW_KEY);
            const status = document.getElementById('check-status');
            
            if (newData) {
                const ideas = JSON.parse(newData);
                status.className = 'status success';
                status.textContent = `‚úÖ New storage has ${ideas.length} ideas`;
            } else {
                status.className = 'status';
                status.textContent = 'New storage is empty';
            }
        }
        
        function migrateData() {
            const oldData = localStorage.getItem(OLD_KEY);
            const status = document.getElementById('migrate-status');
            
            if (!oldData) {
                status.className = 'status error';
                status.textContent = '‚ùå No old data to migrate';
                return;
            }
            
            try {
                const oldIdeas = JSON.parse(oldData);
                
                // Convert old format to new format
                const newIdeas = oldIdeas.map(idea => ({
                    id: idea.id || Date.now(),
                    text: idea.text,
                    project: idea.project || 'untagged',
                    ranking: 3, // Default middle ranking
                    difficulty: 'medium', // Default difficulty
                    timestamp: idea.timestamp || new Date().toISOString(),
                    status: idea.status || 'new'
                }));
                
                // Save to new key
                localStorage.setItem(NEW_KEY, JSON.stringify(newIdeas));
                
                status.className = 'status success';
                status.textContent = `‚úÖ Successfully migrated ${newIdeas.length} ideas!`;
                
                // Optional: remove old key
                // localStorage.removeItem(OLD_KEY);
                
            } catch (e) {
                status.className = 'status error';
                status.textContent = `‚ùå Migration failed: ${e.message}`;
            }
        }
        
        function manualRestore() {
            const data = document.getElementById('manual-data').value.trim();
            const status = document.getElementById('restore-status');
            
            if (!data) {
                status.className = 'status error';
                status.textContent = '‚ùå Please paste data first';
                return;
            }
            
            try {
                const ideas = JSON.parse(data);
                if (!Array.isArray(ideas)) {
                    throw new Error('Data must be an array');
                }
                
                localStorage.setItem(NEW_KEY, JSON.stringify(ideas));
                status.className = 'status success';
                status.textContent = `‚úÖ Restored ${ideas.length} ideas!`;
            } catch (e) {
                status.className = 'status error';
                status.textContent = `‚ùå Restore failed: ${e.message}`;
            }
        }
        
        function exportNewData() {
            const newData = localStorage.getItem(NEW_KEY);
            const display = document.getElementById('export-display');
            
            if (newData) {
                display.value = newData;
            } else {
                display.value = 'No data to export';
            }
        }
    </script>
</body>
</html>
