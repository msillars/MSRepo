<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ideas - Management System</title>
    <link rel="icon" type="image/x-icon" href="../Icons/FavIco.ICO">

    <!-- Windows 3.1 CSS -->
    <link rel="stylesheet" href="layout.css">
    <link rel="stylesheet" href="win3x-theme.css">
    <link rel="stylesheet" href="win3x-skin-3.1.css">
    <link rel="stylesheet" href="topic-page.css">
    <link rel="stylesheet" href="edit-modal.css">

    <style>
        body {
            background: var(--desktop-bg);
            font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif;
            font-size: 11px;
            padding: 8px;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .header-window { flex-shrink: 0; }
        .header-window .window-body {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
        }
        .header-title { font-size: 14px; font-weight: bold; margin: 0; }
        .header-actions { display: flex; gap: 8px; }
        .header-actions a { text-decoration: none; }

        .capture-window { flex-shrink: 0; }
        .capture-window .window-body { padding: 12px; }
        .capture-form { display: flex; gap: 8px; align-items: flex-start; }
        .capture-form textarea {
            flex: 1;
            min-height: 40px;
            resize: vertical;
        }
        .capture-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .capture-row {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .ranking-selector {
            display: flex;
            gap: 4px;
        }
        .rank-btn {
            width: 24px;
            height: 24px;
            min-width: 24px;
            padding: 0;
            font-weight: bold;
        }
        .rank-btn.active {
            color: white;
        }

        .main-content {
            flex: 1;
            display: flex;
            gap: 8px;
            overflow: hidden;
            min-height: 0;
        }

        .list-window {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
            overflow: hidden;
        }
        .list-window .title-bar { flex-shrink: 0; }
        .list-window .title-bar-text {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding-right: 8px;
        }
        .list-count { font-weight: normal; font-size: 10px; }
        .list-window .window-body {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }
        .ideas-list { padding: 0; background: transparent; }
    </style>
</head>
<body>
    <!-- Header Window -->
    <div class="window header-window active">
        <div class="title-bar">
            <div class="title-bar-controls">
                <button class="system-menu" aria-label="System menu" ondblclick="window.location.href='index.html'"></button>
            </div>
            <div class="title-bar-text">Ideas</div>
            <div class="title-bar-controls">
                <button data-minimize aria-label="Minimize"></button>
                <button data-maximize aria-label="Maximize"></button>
            </div>
        </div>
        <div class="window-body">
            <h1 class="header-title">Ideas</h1>
            <div class="header-actions">
                <a href="finished.html"><button>View Finished</button></a>
                <a href="index.html"><button class="primary">Dashboard</button></a>
            </div>
        </div>
    </div>

    <!-- Capture Window -->
    <div class="window capture-window active">
        <div class="title-bar">
            <div class="title-bar-controls">
                <button class="system-menu" aria-label="System menu"></button>
            </div>
            <div class="title-bar-text">New Idea</div>
            <div class="title-bar-controls">
                <button data-minimize aria-label="Minimize"></button>
                <button data-maximize aria-label="Maximize"></button>
            </div>
        </div>
        <div class="window-body">
            <div class="capture-form">
                <textarea id="idea-input" placeholder="What's on your mind?"></textarea>
                <div class="capture-controls">
                    <div class="capture-row">
                        <select id="topic-select"><option value="untagged">Untagged</option></select>
                        <select id="difficulty-select">
                            <option value="easy">Easy</option>
                            <option value="medium" selected>Medium</option>
                            <option value="hard">Hard</option>
                        </select>
                    </div>
                    <div class="capture-row">
                        <div class="ranking-selector" id="ranking-selector"></div>
                        <button class="primary" onclick="captureIdea()">Add</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="window list-window active">
            <div class="title-bar">
                <div class="title-bar-controls">
                    <button class="system-menu" aria-label="System menu"></button>
                </div>
                <div class="title-bar-text">
                    <span>Ideas</span>
                    <span class="list-count" id="ideas-count">0</span>
                </div>
                <div class="title-bar-controls">
                    <button data-minimize aria-label="Minimize"></button>
                    <button data-maximize aria-label="Maximize"></button>
                </div>
            </div>
            <div class="window-body">
                <div class="ideas-list" id="ideas-list" data-status="new"></div>
            </div>
        </div>

        <div class="window list-window active">
            <div class="title-bar">
                <div class="title-bar-controls">
                    <button class="system-menu" aria-label="System menu"></button>
                </div>
                <div class="title-bar-text">
                    <span>Backlog</span>
                    <span class="list-count" id="backlog-count">0</span>
                </div>
                <div class="title-bar-controls">
                    <button data-minimize aria-label="Minimize"></button>
                    <button data-maximize aria-label="Maximize"></button>
                </div>
            </div>
            <div class="window-body">
                <div class="ideas-list" id="backlog-list" data-status="backlog"></div>
            </div>
        </div>
    </div>

    <script src="https://sql.js.org/dist/sql-wasm.js"></script>
    <script src="github-storage.js"></script>
    <script src="sql-database.js"></script>
    <script src="database-init-helper.js"></script>
    <script src="weight-utils.js"></script>
    <script src="ideas-data.js"></script>
    <script src="shared-rendering.js"></script>
    <script src="shared-drag-drop.js"></script>
    <script>
        let selectedRanking = 3;
        let editingIdeaId = null;
        let dragDropManager = null;

        function initializePage() {
            loadTopicOptions();
            createRankingSelector();
            loadAllLists();

            dragDropManager = setupDragAndDrop({
                onDrop: loadAllLists,
                getFilteredIdeas: (status) => getIdeasByStatus(status),
                topicId: null
            });
        }

        function loadTopicOptions() {
            const select = document.getElementById('topic-select');
            const topics = getTopics();
            const options = topics.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
            select.innerHTML = '<option value="untagged">Untagged</option>' + options;
        }

        function createRankingSelector() {
            const container = document.getElementById('ranking-selector');
            container.innerHTML = '';
            for (let i = 1; i <= 5; i++) {
                const btn = document.createElement('button');
                btn.className = 'rank-btn';
                btn.textContent = i;
                btn.onclick = () => selectRanking(i);
                const color = getRankingColor(i);
                if (i === selectedRanking) {
                    btn.classList.add('active');
                    btn.style.background = color;
                    btn.style.borderColor = color;
                }
                container.appendChild(btn);
            }
        }

        function selectRanking(rank) {
            selectedRanking = rank;
            createRankingSelector();
        }

        function captureIdea() {
            const text = document.getElementById('idea-input').value.trim();
            const topic = document.getElementById('topic-select').value;
            const difficulty = document.getElementById('difficulty-select').value;

            if (!text) {
                alert('Please enter an idea');
                return;
            }

            addIdea(text, topic, selectedRanking, difficulty, 'new');
            document.getElementById('idea-input').value = '';
            document.getElementById('topic-select').value = 'untagged';
            document.getElementById('difficulty-select').value = 'medium';
            selectRanking(3);
            loadAllLists();
        }

        function loadAllLists() {
            loadListWithRender('new', 'ideas-list', 'ideas-count', {
                topicId: null,
                showTopic: true,
                showEdit: true,
                editingIdeaId: editingIdeaId
            });

            loadListWithRender('backlog', 'backlog-list', 'backlog-count', {
                topicId: null,
                showTopic: true,
                showEdit: true,
                editingIdeaId: editingIdeaId
            });
        }

        function startEditIdea(ideaId) {
            editingIdeaId = ideaId;
            loadAllLists();
        }

        function saveIdeaEdit(ideaId) {
            const text = document.getElementById(`edit-text-${ideaId}`).value.trim();
            const project = document.getElementById(`edit-project-${ideaId}`).value;
            const difficulty = document.getElementById(`edit-difficulty-${ideaId}`).value;
            const ranking = parseInt(document.getElementById(`edit-ranking-${ideaId}`).value);

            if (!text) {
                alert('Idea text cannot be empty');
                return;
            }

            updateIdea(ideaId, { text, project, difficulty, ranking });
            editingIdeaId = null;
            loadAllLists();
        }

        function cancelEdit() {
            editingIdeaId = null;
            loadAllLists();
        }

        function moveToBacklogHandler(ideaId) {
            moveToBacklog(ideaId);
            loadAllLists();
        }

        function moveToNewHandler(ideaId) {
            moveToNew(ideaId);
            loadAllLists();
        }

        function markAsDone(ideaId) {
            if (confirm('Mark this item as done?')) {
                moveToDone(ideaId);
                loadAllLists();
            }
        }

        function deleteIdeaConfirm(ideaId) {
            if (confirm('Delete this idea? This cannot be undone.')) {
                deleteIdea(ideaId);
                loadAllLists();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const input = document.getElementById('idea-input');
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {
                    e.preventDefault();
                    captureIdea();
                }
            });
        });

        waitForDatabaseThen(() => {
            initializePage();
        });

        window.addEventListener('ideasUpdated', () => {
            loadAllLists();
        });
    </script>
</body>
</html>
