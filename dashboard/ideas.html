<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ideas List - Management System</title>
    <link rel="icon" type="image/x-icon" href="../Icons/FavIco.ICO">
    
    <!-- Windows 3.1 CSS -->
    <link rel="stylesheet" href="layout.css">
    <link rel="stylesheet" href="win3x-theme.css">
    <link rel="stylesheet" href="win3x-skin-3.1.css">
    <link rel="stylesheet" href="edit-modal.css">
</head>
<body>
    <!-- Header -->
    <div class="window page-header active">
        <div class="title-bar">
            <div class="title-bar-text">Ideas</div>
            <div class="title-bar-buttons">
                <button data-minimize></button>
                <button data-maximize></button>
                <button data-close></button>
            </div>
        </div>
        <div class="header-content">
            <h1>Ideas</h1>
            <div class="header-actions">
                <a href="finished.html"><button class="primary">‚úì Finished Items</button></a>
                <a href="index.html"><button>‚Üê Dashboard</button></a>
            </div>
        </div>
    </div>
    
    <!-- Capture Section -->
    <div class="window capture-window active">
        <div class="title-bar">
            <div class="title-bar-text">New Idea</div>
            <div class="title-bar-buttons">
                <button data-minimize></button>
                <button data-maximize></button>
            </div>
        </div>
        <div class="capture-content">
            <div class="capture-form">
                <textarea id="idea-input" placeholder="What's on your mind?"></textarea>
                <div class="capture-controls">
                    <select id="project-select"><option value="untagged">Untagged</option></select>
                    <select id="difficulty-select">
                        <option value="easy">Easy</option>
                        <option value="medium" selected>Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                    <div class="ranking-selector" id="ranking-selector"></div>
                    <button class="primary" onclick="captureIdea()">Add</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Lists -->
    <div class="main-layout">
        <div class="window list-column active">
            <div class="title-bar">
                <div class="title-bar-text">üí° Ideas (<span class="list-count" id="ideas-count">0</span>)</div>
                <div class="title-bar-buttons">
                    <button data-minimize></button>
                    <button data-maximize></button>
                </div>
            </div>
            <div class="list-content" id="ideas-list" data-status="new"></div>
        </div>
        
        <div class="window list-column active">
            <div class="title-bar">
                <div class="title-bar-text">üìã Tomorrow's Backlog (<span class="list-count" id="backlog-count">0</span>)</div>
                <div class="title-bar-buttons">
                    <button data-minimize></button>
                    <button data-maximize></button>
                </div>
            </div>
            <div class="list-content" id="backlog-list" data-status="backlog"></div>
        </div>
    </div>
    
    <script src="https://sql.js.org/dist/sql-wasm.js"></script>
    <script src="github-storage.js"></script>
    <script src="sql-database.js"></script>
    <script src="database-init-helper.js"></script>
    <script src="weight-utils.js"></script>
    <script src="ideas-data.js"></script>
    <script src="shared-rendering.js"></script>
    <script src="shared-drag-drop.js"></script>
    <script>
        let selectedRanking = 3;
        let editingIdeaId = null;
        let dragDropManager = null;

        function initializePage() {
            loadProjectOptions();
            createRankingSelector();
            loadAllLists();
            
            dragDropManager = setupDragAndDrop({
                onDrop: loadAllLists,
                getFilteredIdeas: (status) => getIdeasByStatus(status),
                projectId: null
            });
        }

        function loadProjectOptions() {
            const select = document.getElementById('project-select');
            const topics = getTopics();
            const options = topics.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
            select.innerHTML = '<option value="untagged">Untagged</option>' + options;
        }

        function createRankingSelector() {
            const container = document.getElementById('ranking-selector');
            container.innerHTML = '';
            for (let i = 1; i <= 5; i++) {
                const btn = document.createElement('button');
                btn.className = 'rank-btn';
                btn.textContent = i;
                btn.onclick = () => selectRanking(i);
                const color = getRankingColor(i);
                if (i === selectedRanking) {
                    btn.classList.add('active');
                    btn.style.background = color;
                    btn.style.borderColor = color;
                }
                container.appendChild(btn);
            }
        }

        function selectRanking(rank) {
            selectedRanking = rank;
            createRankingSelector();
        }

        function captureIdea() {
            const text = document.getElementById('idea-input').value.trim();
            const project = document.getElementById('project-select').value;
            const difficulty = document.getElementById('difficulty-select').value;
            
            if (!text) {
                alert('Please enter an idea');
                return;
            }
            
            addIdea(text, project, selectedRanking, difficulty, 'new');
            document.getElementById('idea-input').value = '';
            document.getElementById('project-select').value = 'untagged';
            document.getElementById('difficulty-select').value = 'medium';
            selectRanking(3);
            loadAllLists();
        }

        function loadAllLists() {
            loadListWithRender('new', 'ideas-list', 'ideas-count', {
                projectId: null,
                showProject: true,
                showEdit: true,
                editingIdeaId: editingIdeaId
            });
            
            loadListWithRender('backlog', 'backlog-list', 'backlog-count', {
                projectId: null,
                showProject: true,
                showEdit: true,
                editingIdeaId: editingIdeaId
            });
        }

        function startEditIdea(ideaId) {
            editingIdeaId = ideaId;
            loadAllLists();
        }

        function saveIdeaEdit(ideaId) {
            const text = document.getElementById(`edit-text-${ideaId}`).value.trim();
            const project = document.getElementById(`edit-project-${ideaId}`).value;
            const difficulty = document.getElementById(`edit-difficulty-${ideaId}`).value;
            const ranking = parseInt(document.getElementById(`edit-ranking-${ideaId}`).value);
            
            if (!text) {
                alert('Idea text cannot be empty');
                return;
            }
            
            updateIdea(ideaId, { text, project, difficulty, ranking });
            editingIdeaId = null;
            loadAllLists();
        }

        function cancelEdit() {
            editingIdeaId = null;
            loadAllLists();
        }

        function moveToBacklogHandler(ideaId) {
            moveToBacklog(ideaId);
            loadAllLists();
        }

        function moveToNewHandler(ideaId) {
            moveToNew(ideaId);
            loadAllLists();
        }

        function markAsDone(ideaId) {
            if (confirm('Mark this item as done?')) {
                moveToDone(ideaId);
                loadAllLists();
            }
        }

        function deleteIdeaConfirm(ideaId) {
            if (confirm('Delete this idea? This cannot be undone.')) {
                deleteIdea(ideaId);
                loadAllLists();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const input = document.getElementById('idea-input');
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {
                    e.preventDefault();
                    captureIdea();
                }
            });
        });

        waitForDatabaseThen(() => {
            initializePage();
        });
        
        window.addEventListener('ideasUpdated', () => {
            loadAllLists();
        });
    </script>
</body>
</html>
